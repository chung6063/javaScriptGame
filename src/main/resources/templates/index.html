<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>오로지 자바스크립트로 만든 게임</title>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <style>
        /* 숲속 도트 배경 (전체 배경용) */
        .background-forest {
            display: block;
            width: 512px;
            height: 300px;
            background-image: url('/forest-tile.png'); /* 배경 이미지 */
            background-size: cover;
            top: 100px;
            left: 30%;
            position: absolute;
        }

        .interface {
            display: flex;
            position: absolute;
            top: 0;
            left: 0;
            padding: 10px;
            gap: 20px;
            z-index: 1;
        }

        .game-container {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 29%;
            height: 600px;
            position: relative;
            background-color: #f0f0f0;
        }

        .character-image {
            max-width: 50px;
            max-height: 100px;
            cursor: pointer;
            margin-right: 20px;
            transition: transform 0.3s ease-in-out;
        }

        .character-image:hover {
            transform: scale(1.1); /* 캐릭터 선택 시 확대 효과 */
        }

        #log {
            display: none;
            width: 512px;
            height: 300px;
            border: 2px solid #ccc;
            overflow-y: scroll;
            background-color: #f4f4f4;
            font-family: Arial, sans-serif;
            font-size: 14px;

            position: relative; /* 절대 위치 */
            top: -250px;
        }

        body {
            display: flex;
            justify-content: flex-start;
            align-items: flex-start;
            flex-direction: column;
            margin: 0;
            padding: 10px;
        }

        /* 선택한 캐릭터 이미지 */
        #selectedCharacterImage {
            position: absolute;
            top: 27%; /* 중앙에 위치 */
            left: 38%; /* 왼쪽에 약간 여백을 주기 */
            max-width: 50px;
            max-height: 100px;
            display: none; /* 초기에는 숨기기 */
        }

        /* 몬스터 이미지 */
        #monster-image {
            position: absolute;
            top: 30%; /* 중앙에 위치 */
            right: 45%; /* 오른쪽에 약간 여백을 주기 */
            max-width: 50px;
            max-height: 100px;
            display: none; /* 초기에는 숨기기 */
        }

        /* 플레이어 공격 애니메이션 */
        @keyframes characterAttackAnimation {
            0% {
                transform: translateX(0); /* 원래 위치 */
            }
            50% {
                transform: translateX(10px); /* 오른쪽으로 이동 */
            }
            100% {
                transform: translateX(0); /* 원래 위치로 돌아옴 */
            }
        }

        /* 슬라임 공격 애니메이션 */
        @keyframes slimeAttackAnimation {
            0% {
                transform: translateX(0); /* 원래 위치 */
            }
            50% {
                transform: translateX(-20px); /* 왼쪽으로 이동 */
            }
            100% {
                transform: translateX(0); /* 원래 위치로 돌아옴 */
            }
        }

        /* 공격 애니메이션을 각 캐릭터에 적용 */
        .character-attacking {
            animation: characterAttackAnimation 0.5s ease-in-out;
        }

        .slime-attacking {
            animation: slimeAttackAnimation 0.5s ease-in-out;
        }

        #jobBackGround {
            display: flex;
            justify-content: center;  /* 가로 중앙 */
            align-items: center;      /* 세로 중앙 */
            flex-direction: column;   /* 세로로 배치 */
            height: 100px;            /* 부모 요소의 높이 설정 */
            padding: 45px;
            left: 35%;
            bottom: 450px;
            position: absolute;
        }

        .inventory , equipment {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            border: 2px solid #ccc;
            padding : 20px;
            background-color: #f9f9f9;
            max-width : 250px;
            margin: 10px;
        }
        .inventory-item, .equipment-slot {
            width: 50px;
            height: 50px;
            border: 1px solid #999;
            background-color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }

        .inventory-item:hover, .equipment-slot:hover {
            background-color: #e0e0e0;
        }

        .equipment-slot {
            background-color: #d4d4d4;
        }

        .inventory-item img, .equipment-slot img {
            max-width: 100%;
            max-height: 100%;
        }
        /* 선택된 아이템 강조 */
        .inventory-item.selected {
            border: 2px solid blue;
        }

        /* 장착 가능한 슬롯 강조 */
        .equipment-slot.highlight {
            border: 2px solid green;
            background-color: #eaffea;
        }
        /* 상점 스타일 */
        .shop {
            position: absolute;
            right: 10px;
            top: 100px;
            width: 200px;
            padding: 10px;
            border: 2px solid #ccc;
            background-color: #f9f9f9;
        }

        .shop h2 {
            margin: 0 0 10px;
            font-size: 18px;
            text-align: center;
        }

        .shop-item {
            padding: 5px;
            margin-bottom: 5px;
            border: 1px solid #999;
            background-color: #fff;
            cursor: pointer;
            text-align: center;
        }

        .shop-item:hover {
            background-color: #e0e0e0;
        }

        .ui-button{
            position: absolute;
            top: 50%;  /* background-forest 아래에 배치 */
            left: 43%;
            display: flex;
            justify-content: center; /* 버튼들을 가로로 정렬 */
        }

        #stats-container{
            position: absolute;
            top: 3px;            /* background-forest와 동일한 상단 위치 */
            left: 80%; /* background-forest 오른쪽에 10px 여백 추가 */
            width: 150px;          /* 원하는 너비 */
            padding: 10px;         /* 내부 여백 */
            background-color: rgba(0, 0, 0, 0.5); /* 반투명 배경 */
            color: white;          /* 텍스트 색상 */
            border-radius: 10px;   /* 모서리 둥글게 */
            font-family: Arial, sans-serif; /* 폰트 설정 */
            font-size: 14px;       /* 폰트 크기 */
            z-index: 10;           /* 다른 요소들보다 위에 보이도록 설정 */
        }

        #enemyStats-container {
            position: absolute;
            top: 100px;            /* background-forest와 동일한 상단 위치 */
            left: calc(30% + 512px + 10px); /* background-forest 오른쪽에 10px 여백 추가 */
            width: 200px;          /* 원하는 너비 */
            padding: 10px;         /* 내부 여백 */
            background-color: rgba(0, 0, 0, 0.5); /* 반투명 배경 */
            color: white;          /* 텍스트 색상 */
            border-radius: 10px;   /* 모서리 둥글게 */
            font-family: Arial, sans-serif; /* 폰트 설정 */
            font-size: 14px;       /* 폰트 크기 */
            z-index: 10;           /* 다른 요소들보다 위에 보이도록 설정 */
        }
    </style>
</head>
<body>
<h1 class="text-center my-4">오로지 자바스크립트로 만든게임</h1>
<div class="game-container">
    <div class="background"></div>
    <div class="interface">
        <!-- 장비창 -->
        <div class="equipment">
            <div class="equipment-slot" id="head-slot" onclick="equipItem('head')">머리</div>
            <div class="equipment-slot" id="armor-slot" onclick="equipItem('armor')">갑옷</div>
            <div class="equipment-slot" id="weapon-slot" onclick="equipItem('weapon')">무기</div>
            <br>
            <br>
            <br>
            <!-- 인벤토리 -->
            <div class="inventory" id="inventory">
                <!-- 20칸의 인벤토리 생성 -->
                <script>
                    for (let i = 0; i < 20; i++) {
                        document.write(`<div class='inventory-item' onclick='selectInventoryItem(${i})' id='inventory-item-${i}'></div>`);
                    }
                </script>
            </div>
        </div>
        <!-- 상태 표시 영역 -->
        <div id="stats-container">
            <p>JOB:<span id="job"></span></p>
            <p>HP: <span id="health"></span></p>
            <p>ATK: <span id="attack"></span></p>
            <p>DEF: <span id="defense"></span></p>
            <p>SPEED: <span id="speed"></span></p>
            <p>GOLD: <span id="gold"></span></p>
        </div>
    </div>
</div>


<!--몬스터 상세정보-->
<div id="enemyStats-container">
    <p>MONSTER: <span id="monster-name"></span></p>
    <p>HP: <span id="monster-hp"></span></p>
    <p>ATK: <span id="monster-attack"></span></p>
    <p>DEF: <span id="monster-defense"></span></p>
</div>

<!--상점-->
<div class="shop">
    <h2>상점</h2>
    <div class="shop-item" onclick="buyItem(0)">철 헬멧 (100 골드)</div>
    <div class="shop-item" onclick="buyItem(1)">가죽 갑옷 (200 골드)</div>
    <div class="shop-item" onclick="buyItem(2)">장검 (300 골드)</div>
    <div class="shop-item" onclick="buyItem(3)">체력 포션 (50 골드)</div>
</div>

<!-- 숲속 배경 -->
<div class="background-forest" id="background-forest"></div>

<!-- 캐릭터 선택 화면 -->
<div id="jobBackGround" style="display: none;">
        <img src="/warrior.png" alt="전사" class="character-image" onclick="selectJob('warrior')">
        <img src="/thief.png" alt="도둑" class="character-image" onclick="selectJob('thief')">
        <img src="/archer.png" alt="궁수" class="character-image" onclick="selectJob('archer')">
        <img src="/wizard.png" alt="마법사" class="character-image" onclick="selectJob('wizard')">
</div>

<!--선택한 캐릭터 이미지-->
<div id="character-background">
    <img id="selectedCharacterImage" alt="캐릭터 이미지">
</div>

<!--몬스터이미지가 나오는곳-->
<div class="text-center my-4">
    <img src="/slime.png" id="monster-image" alt="몬스터 이미지">
</div>

<!-- 시작 및 진행 버튼 -->
<div class="ui-button">
    <button id="gameStartButton" onclick="gameStart()">게임 시작</button>
    <button id="gameBattleButton" onclick="gameBattle()" style="display: none;">진행하기</button>
    <button id="nextFloorButton" onclick="nextFloor()" style="display: none;">다음 층으로 가기</button>
    <button id="confirmSelectionButton" onclick="confirmJobSelection()" style="display: none;">선택 완료</button>
</div>

<!-- 로그 박스 -->
<div class="card" style="width: 100%; max-width: 600px; margin: auto;">
    <div class="card-body">
        <div id="log" class="overflow-auto" style="max-height: 300px;"></div>
    </div>
</div>

<script>
    let player;
    let selectedJob = null;
    let currentFloor = 1;
    let currentEnemy = null;
    let playerGold = 0; // 플레이어 초기 골드

    const enemyStats = [
        {name: "슬라임", hp: 30, atk: 3, def: 1},
    ];

    const jobs = {
        warrior: {hp: 100, atk: 5, def: 5, speed: 3, gold: 0, items: []},
        thief: {hp: 100, atk: 5, def: 3, speed: 7, gold: 0, items: []},
        archer: {hp: 100, atk: 7, def: 3, speed: 5, gold: 0, items: []},
        wizard: {hp: 100, atk: 10, def: 1, speed: 1, gold: 0, items: []}
    };

    const logDiv = document.getElementById("log");

    // 아이템 정의
    const shopItems = [
        { name: '철 헬멧', type: 'head', price: 100, image: 'helmet.png', atk: 0, def: 5, hp: 0 },
        { name: '가죽 갑옷', type: 'armor', price: 200, image: 'armor.png', atk: 0, def: 10, hp: 0 },
        { name: '장검', type: 'weapon', price: 300, image: 'sword.png', atk: 20, def: 0, hp: 0 },
        { name: '포션', type: 'potion', price: 50, image: 'potion.png', atk: 0, def: 0, hp: 50 }
    ];


    // 인벤토리와 장비 상태를 저장
    const inventory = Array(20).fill(null); // 최대 20개의 아이템

    // 장착한 아이템을 저장할 배열 (각각의 슬롯에 아이템을 장착)
    let equippedItems = {
        head: null,
        armor: null,
        weapon: null,
        potion: null
    };

    let selectedInventoryIndex = null; // 현재 선택된 인벤토리 아이템

    // 몬스터 상태 업데이트 함수
    function updateEnemyStats() {
        if (currentEnemy) {
            document.getElementById("monster-name").textContent = currentEnemy.name;
            document.getElementById("monster-hp").textContent = currentEnemy.hp;
            document.getElementById("monster-attack").textContent = currentEnemy.atk;
            document.getElementById("monster-defense").textContent = currentEnemy.def;
        }
    }

    function statusUpdate(){
        const selectedJobDetails = jobs[selectedJob];

        // 직업 정보 업데이트
        document.getElementById("health").textContent = selectedJobDetails.hp;
        document.getElementById("attack").textContent = selectedJobDetails.atk;
        document.getElementById("defense").textContent = selectedJobDetails.def;
        document.getElementById("speed").textContent = selectedJobDetails.speed;
        document.getElementById("gold").textContent = selectedJobDetails.gold;
    }

    function gameBattle() {
        if (!player) {
            log("먼저 직업을 선택해주세요!");
            return;
        }

        // 적 생성
        currentEnemy = generateEnemy(currentFloor);
        log(`적이 나타났습니다: ${currentEnemy.name}! `);

        // 몬스터 상태 업데이트
        updateEnemyStats();

        // 배틀 시작
        battleLoop();
    }

    function battleLoop() {
        let isPlayerTurn = true;  // 플레이어의 공격이 먼저 시작

        const interval = setInterval(function() {
            const characterImage = document.getElementById("selectedCharacterImage");
            const monsterImage = document.getElementById("monster-image");

            if (isPlayerTurn) {
                // 플레이어가 공격할 때 애니메이션
                characterImage.classList.add("character-attacking");
                // 플레이어가 적을 공격
                attackEnemy();

                // 몬스터 상태 업데이트
                updateEnemyStats();

                // 애니메이션 끝난 후 클래스 제거
                setTimeout(function() {
                    characterImage.classList.remove("character-attacking");
                }, 500); // 애니메이션 지속 시간에 맞춰 제거

                // 적이 죽었는지 확인
                if (currentEnemy.hp <= 0) {
                    log(`${currentEnemy.name}을(를) 처치했습니다!`);

                    // 플레이어의 골드 증가
                    jobs[selectedJob].gold += 50;  // 선택된 직업의 골드도 증가시킴

                    statusUpdate();

                    log(`골드가 증가했습니다!`);



                    clearInterval(interval);  // 전투 종료
                    document.getElementById("nextFloorButton").style.display = "block";  // 다음 층으로 이동 버튼 활성화
                    document.getElementById("gameBattleButton").style.display = "none";  // "진행하기" 버튼 숨기기
                    return;
                }

                // 슬라임이 공격할 차례
                isPlayerTurn = false;
            } else {
                // 슬라임이 공격할 때 애니메이션
                monsterImage.classList.add("slime-attacking");
                // 적이 플레이어를 공격
                attackPlayer();

                // 애니메이션 끝난 후 클래스 제거
                setTimeout(function() {
                    monsterImage.classList.remove("slime-attacking");
                }, 500); // 애니메이션 지속 시간에 맞춰 제거

                // 플레이어가 죽었는지 확인
                if (player.hp <= 0) {
                    log("당신은 패배했습니다. 게임 오버!");
                    clearInterval(interval);  // 전투 종료
                    return;
                }

                // 플레이어의 공격 차례로 변경
                isPlayerTurn = true;
            }

            // 전투 후 상태 업데이트
            statusUpdate();

        }, 700); // 1초 간격으로 공격 진행
    }

    function attackEnemy() {
        const playerDamage = Math.max(0, player.atk - currentEnemy.def);
        currentEnemy.hp -= playerDamage;
        log(`당신이 ${currentEnemy.name}에게 ${playerDamage}의 데미지를 입혔습니다! `);
    }

    function attackPlayer() {
        const enemyDamage = Math.max(0, currentEnemy.atk - player.def);
        player.hp -= enemyDamage;
        log(`${currentEnemy.name}이(가) 당신에게 ${enemyDamage}의 데미지를 입혔습니다! `);
    }

    function nextFloor() {
        currentFloor++;
        log(`축하합니다! ${currentFloor}층으로 이동합니다.`);
        document.getElementById("gameBattleButton").style.display = "block";
        document.getElementById("nextFloorButton").style.display = "none";
    }

    function generateEnemy(floor) {
        const index = Math.min(floor - 1, enemyStats.length - 1);
        const baseEnemy = enemyStats[index];
        return {
            ...baseEnemy,
            hp: baseEnemy.hp + floor * 5,
            atk: baseEnemy.atk + floor,
            def: baseEnemy.def + Math.floor(floor / 2)
        };
    }

    function log(message) {
        logDiv.innerHTML += `<p>${message}</p>`;
        logDiv.scrollTop = logDiv.scrollHeight;
    }

    function gameStart() {
        document.getElementById("gameStartButton").style.display = "none";
        document.getElementById("jobBackGround").style.display = "block";
        document.getElementById("log").style.display = "block";
        log("게임을 시작합니다. 직업을 선택해주세요!");
    }

    function selectJob(job) {
        selectedJob = job;
        const selectedJobDetails = jobs[job];  // 선택된 직업의 세부 정보를 가져옵니다.

        // 직업 선택 완료 버튼 표시
        document.getElementById("confirmSelectionButton").style.display = "block";

        // 직업 정보 업데이트
        document.getElementById("job").textContent = job;
        document.getElementById("health").textContent = selectedJobDetails.hp;
        document.getElementById("attack").textContent = selectedJobDetails.atk;
        document.getElementById("defense").textContent = selectedJobDetails.def;
        document.getElementById("speed").textContent = selectedJobDetails.speed;
        document.getElementById("gold").textContent = selectedJobDetails.gold;

    }

    function confirmJobSelection() {
        if (!selectedJob) {
            log("직업을 선택해주세요!");
            return;
        }

        player = jobs[selectedJob];
        const characterSrc = `/${selectedJob}.png`;

        // 캐릭터 선택 화면 숨기기
        document.getElementById("jobBackGround").style.display = "none";

        //선택완료 버튼 숨기기
        document.getElementById("confirmSelectionButton").style.display = "none";

        let characterImage = document.getElementById("selectedCharacterImage");

        characterImage.src = characterSrc;

        log(`직업 선택 완료: ${selectedJob}로 게임을 시작합니다.`);
        document.getElementById("gameBattleButton").style.display = "block";
        document.getElementById("selectedCharacterImage").style.display = "block";
        document.getElementById("monster-image").style.display = "block";
    }

    // 인벤토리에 아이템 추가
    function initializeInventory() {
        updateInventoryUI();
    }

    // 인벤토리 UI 업데이트
    function updateInventoryUI() {
        inventory.forEach((item, index) => {
            const slot = document.getElementById(`inventory-item-${index}`);
            if (item) {
                slot.innerHTML = `<img src="${item.image}" alt="${item.name}">`;
            } else {
                slot.innerHTML = '';
            }
        });
    }

    // 장비창 UI 업데이트
    function updateEquipmentUI() {
        Object.keys(equipment).forEach(slot => {
            const equipmentSlot = document.getElementById(`${slot}-slot`);
            const item = equipment[slot];
            if (item) {
                equipmentSlot.innerHTML = `<img src="${item.image}" alt="${item.name}">`;
            } else {
                equipmentSlot.innerHTML = slot === 'head' ? '머리' : slot === 'armor' ? '갑옷' : '무기';
            }
        });
    }

    // 인벤토리 아이템 선택
    function selectInventoryItem(index) {
        if (inventory[index]) {
            selectedInventoryIndex = index;

            // 모든 슬롯에서 선택 제거 후 현재 슬롯 강조
            document.querySelectorAll('.inventory-item').forEach(item => item.classList.remove('selected'));
            document.getElementById(`inventory-item-${index}`).classList.add('selected');

            // 장착 가능한 슬롯 강조
            highlightEquipableSlots(inventory[index].type);
        } else {
            alert('빈 슬롯입니다.');
        }
    }

    // 장착 가능한 슬롯 강조
    function highlightEquipableSlots(type) {
        updateEquipmentUI(); // 기존 강조 제거

        const slotId = type === 'head' ? 'head-slot' : type === 'armor' ? 'armor-slot' : 'weapon-slot';
        const slotElement = document.getElementById(slotId);
        if (slotElement) {
            slotElement.classList.add('highlight');
        }
    }

    // 아이템 장착
    function equipItem(slot) {
        if (selectedInventoryIndex === null || !inventory[selectedInventoryIndex]) {
            alert('선택한 아이템이 없습니다.');
            return;
        }

        const selectedItem = inventory[selectedInventoryIndex];
        if (selectedItem.type !== slot) {
            alert(`${slot}에 장착할 수 없는 아이템입니다.`);
            return;
        }

        // 기존 장비를 인벤토리로 이동
        if (equipment[slot]) {
            inventory[selectedInventoryIndex] = equipment[slot];
        } else {
            inventory[selectedInventoryIndex] = null;
        }

        // 선택한 아이템을 장비로 이동
        equipment[slot] = selectedItem;
        selectedInventoryIndex = null;

        updateInventoryUI();
        updateEquipmentUI();
    }

    // 아이템 구매 함수
    function buyItem(index) {
        const item = shopItems[index];

        // 선택한 직업의 골드 확인
        const selectedJobDetails = jobs[selectedJob];

        // 골드가 충분한지 확인
        if (selectedJobDetails.gold >= item.price) {
            // 인벤토리에 빈 슬롯이 있는지 확인
            const emptySlot = inventory.findIndex(slot => slot === null);

            if (emptySlot !== -1) {
                // 아이템을 인벤토리 슬롯에 추가
                inventory[emptySlot] = item;

                // 직업의 골드를 차감
                selectedJobDetails.gold -= item.price;

                // 아이템의 효과를 직업 스탯에 반영
                applyItemStats(item);

                // 인벤토리 UI 갱신
                updateInventoryUI();

                // 아이템 구매 완료 알림
                alert(`${item.name}을(를) 구매했습니다!`);

                // 상태 업데이트 (골드 표시 반영)
                statusUpdate();
            } else {
                alert('인벤토리가 가득 찼습니다.');
            }
        } else {
            alert('골드가 부족합니다.');
        }
    }

    // 아이템 효과를 직업 스탯에 반영하는 함수
    function applyItemStats(item) {
        const selectedJobDetails = jobs[selectedJob];

        // 아이템 종류에 따른 스탯 적용
        if (item.type === 'weapon') {
            selectedJobDetails.atk += item.atk;  // 무기: 공격력 증가
        } else if (item.type === 'armor') {
            selectedJobDetails.def += item.def;  // 갑옷: 방어력 증가
        } else if (item.type === 'head') {
            selectedJobDetails.def += item.def;  // 헬멧: 방어력 증가
        } else if (item.type === 'potion') {
            selectedJobDetails.hp += item.hp;  // 포션: 체력 회복
        }
    }

    initializeInventory();

    function usePotion() {
        const potion = equippedItems.potion;
        if (potion) {
            selectedJobDetails.hp += potion.hp;
            alert(`포션을 사용하여 체력이 ${potion.hp}만큼 회복되었습니다!`);
            // 포션 사용 후, 인벤토리에서 포션을 제거
            equippedItems.potion = null;
            statusUpdate();  // 스탯 업데이트
        } else {
            alert('포션이 없습니다!');
        }
    }
    // 아이템 장착 함수
    function equipItem(index) {
        const item = inventory[index];  // 인벤토리에서 아이템을 가져옴
        const selectedJobDetails = jobs[selectedJob];  // 선택한 직업의 정보 가져오기

        // 아이템 장착
        if (item) {
            if (item.type === 'weapon') {
                // 무기 장착 시 공격력 증가
                selectedJobDetails.atk += item.atk;
            } else if (item.type === 'armor' || item.type === 'head') {
                // 갑옷 또는 헬멧 장착 시 방어력 증가
                selectedJobDetails.def += item.def;
            } else if (item.type === 'potion') {
                // 포션 사용 시 체력 회복
                selectedJobDetails.hp += item.hp;
            }

            // 장착한 아이템을 인벤토리에서 제거
            inventory[index] = null;

            // 상태 업데이트
            statusUpdate();
            updateInventoryUI();  // 인벤토리 UI 갱신
            alert(`${item.name}을(를) 장착했습니다!`);
        } else {
            alert('장착할 아이템이 없습니다.');
        }
    }
</script>
</body>
</html>
